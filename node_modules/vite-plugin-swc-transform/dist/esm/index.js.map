{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import {\n  type FilterPattern as RollupFilterPattern,\n  createFilter,\n} from \"@rollup/pluginutils\";\nimport { type Options as SWCOptions, transform } from \"@swc/core\";\nimport type { Plugin, UserConfig } from \"vite\";\n\nimport { checkSwcOptionsOnce } from \"./check-options-once.js\";\nimport { getTransformOptions } from \"./get-transform-options.js\";\nimport type { Params } from \"./types.js\";\n\nconst EMPTY_OBJECT = Object.freeze({});\n\nlet _swcOptions = EMPTY_OBJECT;\n\nfunction transformFile(\n  id: string,\n  code: string,\n  swcOptions: NonNullable<Params[\"swcOptions\"]>,\n  suppressLegacyDecoratorNoExplicitUDFCFWarning: NonNullable<\n    Params[\"suppressLegacyDecoratorNoExplicitUDFCFWarning\"]\n  >,\n) {\n  const [filepath] = id.split(\"?\", 1);\n\n  if (_swcOptions === EMPTY_OBJECT) {\n    const { jsc, legacyDecorator } = checkSwcOptionsOnce({\n      swcOptions,\n      suppressLegacyDecoratorNoExplicitUDFCFWarning,\n    });\n    _swcOptions = getTransformOptions({ swcOptions, jsc, legacyDecorator });\n  }\n\n  const transformOptions: SWCOptions = Object.assign(\n    {\n      filename: id,\n      sourceFileName: filepath,\n    },\n    _swcOptions,\n  );\n\n  return transform(code, transformOptions);\n}\n\nexport default function createViteSWCTransformPlugin({\n  include,\n  exclude,\n  suppressLegacyDecoratorNoExplicitUDFCFWarning = false,\n  swcOptions,\n}: Params = {}): Plugin {\n  const filter = createFilter(include ?? /\\.tsx?$/, exclude ?? /node_modules/);\n  return {\n    name: \"swc-transform\" as const,\n    enforce: \"pre\",\n    config(config: UserConfig) {\n      config.esbuild = false;\n      config.build = Object.assign(config.build || {}, { target: \"esnext\" });\n    },\n    transform(code, id) {\n      if (!filter(id)) return null;\n      return transformFile(\n        id,\n        code,\n        swcOptions ?? EMPTY_OBJECT,\n        suppressLegacyDecoratorNoExplicitUDFCFWarning,\n      );\n    },\n  };\n}\n\nexport type { Params, RollupFilterPattern, SWCOptions };\n"],"names":["EMPTY_OBJECT","Object","freeze","_swcOptions","transformFile","id","code","swcOptions","suppressLegacyDecoratorNoExplicitUDFCFWarning","filepath","split","jsc","legacyDecorator","checkSwcOptionsOnce","getTransformOptions","transformOptions","assign","filename","sourceFileName","transform","createViteSWCTransformPlugin","include","exclude","filter","createFilter","name","enforce","config","esbuild","build","target"],"mappings":";;;;;AAWA,MAAMA,YAAeC,GAAAA,MAAAA,CAAOC,MAAM,CAAC,EAAC,CAAA;AAEpC,IAAIC,WAAcH,GAAAA,YAAAA;AAElB,SAASI,cACPC,EAAU,EACVC,IAAY,EACZC,UAA6C,EAC7CC,6CAEC,EAAA;AAED,IAAA,MAAM,CAACC,QAAS,CAAA,GAAGJ,EAAGK,CAAAA,KAAK,CAAC,GAAK,EAAA,CAAA,CAAA;AAEjC,IAAA,IAAIP,gBAAgBH,YAAc,EAAA;AAChC,QAAA,MAAM,EAAEW,GAAG,EAAEC,eAAe,EAAE,GAAGC,mBAAoB,CAAA;AACnDN,YAAAA,UAAAA;AACAC,YAAAA;AACF,SAAA,CAAA;AACAL,QAAAA,WAAAA,GAAcW,mBAAoB,CAAA;AAAEP,YAAAA,UAAAA;AAAYI,YAAAA,GAAAA;AAAKC,YAAAA;AAAgB,SAAA,CAAA;AACvE;IAEA,MAAMG,gBAAAA,GAA+Bd,MAAOe,CAAAA,MAAM,CAChD;QACEC,QAAUZ,EAAAA,EAAAA;QACVa,cAAgBT,EAAAA;KAElBN,EAAAA,WAAAA,CAAAA;AAGF,IAAA,OAAOgB,UAAUb,IAAMS,EAAAA,gBAAAA,CAAAA;AACzB;AAEe,SAASK,4BAAAA,CAA6B,EACnDC,OAAO,EACPC,OAAO,EACPd,6CAAgD,GAAA,KAAK,EACrDD,UAAU,EACH,GAAG,EAAE,EAAA;AACZ,IAAA,MAAMgB,MAASC,GAAAA,YAAAA,CAAaH,OAAW,IAAA,SAAA,EAAWC,OAAW,IAAA,cAAA,CAAA;IAC7D,OAAO;QACLG,IAAM,EAAA,eAAA;QACNC,OAAS,EAAA,KAAA;AACTC,QAAAA,MAAAA,CAAAA,CAAOA,MAAkB,EAAA;AACvBA,YAAAA,MAAAA,CAAOC,OAAO,GAAG,KAAA;YACjBD,MAAOE,CAAAA,KAAK,GAAG5B,MAAOe,CAAAA,MAAM,CAACW,MAAOE,CAAAA,KAAK,IAAI,EAAI,EAAA;gBAAEC,MAAQ,EAAA;AAAS,aAAA,CAAA;AACtE,SAAA;QACAX,SAAUb,CAAAA,CAAAA,IAAI,EAAED,EAAE,EAAA;YAChB,IAAI,CAACkB,MAAOlB,CAAAA,EAAAA,CAAAA,EAAK,OAAO,IAAA;AACxB,YAAA,OAAOD,aACLC,CAAAA,EAAAA,EACAC,IACAC,EAAAA,UAAAA,IAAcP,YACdQ,EAAAA,6CAAAA,CAAAA;AAEJ;AACF,KAAA;AACF;;;;"}